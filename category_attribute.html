<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gán thuộc tính cho Category</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .attribute-item {
      margin-bottom: 8px;
      background: #f8f9fa;
      padding: 8px 12px;
      border-radius: 5px;
      transition: background 0.3s;
    }

    .attribute-item:hover {
      background: #e2e6ea;
    }

    .category-header {
      font-weight: bold;
    }
  </style>
</head>
<body class="container py-4">

  <h4 class="mb-4">Gán thuộc tính cho các danh mục</h4>

  <form onsubmit="event.preventDefault(); saveAllSelections();">
    <div class="accordion" id="categoryAccordion">
      <!-- Render category + attribute tại đây -->
    </div>

    <div class="mt-4">
      <button type="submit" class="btn btn-primary">Lưu tất cả thiết lập</button>
    </div>
  </form>

  <script>
    const categories = [
      { id: 1, name: "Laptop" },
      { id: 2, name: "PC" },
      { id: 3, name: "Phụ kiện" },
    ];

    const attributes = [
      { id: 1, name: "CPU" },
      { id: 2, name: "RAM" },
      { id: 3, name: "SSD" },
      { id: 4, name: "Màn hình" },
      { id: 5, name: "Màu sắc" },
      { id: 6, name: "Tần số quét" },
      { id: 7, name: "Trọng lượng" },
    ];

    const selectedMap = {}; // Lưu selected attribute theo từng category

    function renderAccordion() {
      const container = document.getElementById("categoryAccordion");
      container.innerHTML = "";

      categories.forEach((cat, index) => {
        selectedMap[cat.id] = new Set();

        const catId = `category-${cat.id}`;
        const collapseId = `collapse-${cat.id}`;

        const item = document.createElement("div");
        item.className = "accordion-item";

        item.innerHTML = `
          <h2 class="accordion-header" id="${catId}">
            <button class="accordion-button ${index > 0 ? 'collapsed' : ''}" type="button" data-bs-toggle="collapse" data-bs-target="#${collapseId}" aria-expanded="${index === 0}" aria-controls="${collapseId}">
              ${cat.name}
            </button>
          </h2>
          <div id="${collapseId}" class="accordion-collapse collapse ${index === 0 ? 'show' : ''}" aria-labelledby="${catId}" data-bs-parent="#categoryAccordion">
            <div class="accordion-body row" id="attribute-list-${cat.id}">
              <!-- attribute render tại đây -->
            </div>
          </div>
        `;

        container.appendChild(item);

        renderAttributesForCategory(cat.id);
      });
    }

    function renderAttributesForCategory(categoryId) {
      const wrapper = document.getElementById(`attribute-list-${categoryId}`);

      attributes.forEach(attr => {
        const col = document.createElement("div");
        col.classList.add("col-md-4");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.classList.add("form-check-input");
        checkbox.id = `cat${categoryId}-attr${attr.id}`;
        checkbox.value = attr.id;

        checkbox.addEventListener("change", () => {
          const set = selectedMap[categoryId];
          if (checkbox.checked) {
            set.add(attr.id);
          } else {
            set.delete(attr.id);
          }
        });

        const label = document.createElement("label");
        label.classList.add("form-check-label", "attribute-item", "d-block");
        label.htmlFor = `cat${categoryId}-attr${attr.id}`;
        label.textContent = attr.name;

        label.prepend(checkbox);
        col.appendChild(label);
        wrapper.appendChild(col);
      });
    }

    function saveAllSelections() {
      const results = [];

      Object.keys(selectedMap).forEach(catId => {
        const attrIds = Array.from(selectedMap[catId]);
        results.push({ categoryId: parseInt(catId), attributeIds: attrIds });
      });

      console.log("Kết quả:", results);
      alert("Đã lưu tất cả thiết lập! Xem console để xem dữ liệu gửi đi.");
      // TODO: Gửi dữ liệu về server qua AJAX hoặc fetch
    }

    renderAccordion();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
