<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Danh Mục Đa Cấp</title>
    <style>
        :root {
            --primary-color: #4c6ef5;
            --success-color: #40c057;
            --danger-color: #fa5252;
            --border-color: #dee2e6;
            --bg-hover: #f8f9fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        h1 {
            font-size: 24px;
            color: #333;
        }
        
        .btn-add {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }
        
        .btn-add:hover {
            background-color: #364fc7;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th:first-child, td:first-child {
            width: 40px;
            text-align: center;
        }
        
        th {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 600;
        }
        
        tbody tr:hover {
            background-color: var(--bg-hover);
        }
        
        .sort-icon {
            margin-left: 5px;
            font-size: 12px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn-edit, .btn-delete {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .btn-edit {
            color: var(--primary-color);
        }
        
        .btn-delete {
            color: var(--danger-color);
        }
        
        .btn-edit:hover, .btn-delete:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 20px;
        }
        
        .pagination button {
            border: 1px solid var(--border-color);
            background-color: white;
            color: #333;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .pagination button:hover {
            background-color: var(--bg-hover);
        }
        
        .pagination button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: white;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }
        
        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(76, 110, 245, 0.1);
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
        }
        
        .btn-cancel {
            background-color: #e9ecef;
            color: #495057;
        }
        
        .btn-cancel:hover {
            background-color: #dee2e6;
        }
        
        .btn-save {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-save:hover {
            background-color: #364fc7;
        }
        
        /* Checkbox styling */
        .checkbox-wrapper {
            position: relative;
            width: 20px;
            height: 20px;
            margin: 0 auto;
        }
        
        .checkbox-custom {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }
        
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 20px;
            width: 20px;
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 3px;
        }
        
        .checkbox-wrapper:hover .checkmark {
            background-color: #f8f9fa;
        }
        
        .checkbox-custom:checked ~ .checkmark {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }
        
        .checkbox-custom:checked ~ .checkmark:after {
            display: block;
        }
        
        .checkbox-wrapper .checkmark:after {
            left: 7px;
            top: 3px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-active {
            background-color: rgba(64, 192, 87, 0.1);
            color: var(--success-color);
        }
        
        .status-inactive {
            background-color: rgba(173, 181, 189, 0.1);
            color: #adb5bd;
        }
        
        /* Display hierarchy levels */
        .category-level-1 {
            font-weight: 600;
        }
        
        .category-level-2 {
            padding-left: 20px;
            position: relative;
        }
        
        .category-level-2::before {
            content: "—";
            position: absolute;
            left: 5px;
            color: #adb5bd;
        }
        
        .category-level-3 {
            padding-left: 40px;
            position: relative;
        }
        
        .category-level-3::before {
            content: "——";
            position: absolute;
            left: 5px;
            color: #adb5bd;
        }
        
        /* Message styling */
        .message {
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .message.show {
            opacity: 1;
        }
        
        .message-success {
            background-color: var(--success-color);
        }
        
        .message-error {
            background-color: var(--danger-color);
        }
        
        .message-icon {
            font-size: 20px;
        }
        
        .message-content {
            flex-grow: 1;
        }
        
        .message-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            opacity: 0.8;
        }
        
        .message-close:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Quản Lý Danh Mục</h1>
            <button class="btn-add" onclick="openAddModal()">
                <span>+</span> Thêm danh mục
            </button>
        </header>

        <div id="message-container"></div>

        <table>
            <thead>
                <tr>
                    <th>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="select-all" class="checkbox-custom">
                            <label for="select-all" class="checkmark"></label>
                        </div>
                    </th>
                    <th>Tên Thuộc Tính <span class="sort-icon">↕</span></th>
                    <th>ID</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="categories-table">
                <!-- Dữ liệu sẽ được thêm vào đây bằng JavaScript -->
            </tbody>
        </table>

        <div class="pagination" id="pagination">
            <button disabled>&laquo;</button>
            <button disabled>&lt;</button>
            <button class="active">1</button>
            <button disabled>&gt;</button>
            <button disabled>&raquo;</button>
        </div>
    </div>

    <!-- Modal thêm/sửa danh mục -->
    <div class="modal-overlay" id="category-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Thêm Danh Mục Mới</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="category-name">Tên Danh Mục</label>
                    <input type="text" id="category-name" placeholder="Nhập tên danh mục...">
                </div>
                <div class="form-group">
                    <label for="parent-category">Danh Mục Cha</label>
                    <select id="parent-category">
                        <option value="NULL">Không có danh mục cha (Cấp cao)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal()">Hủy</button>
                <button class="btn btn-save" id="save-category" onclick="saveCategory()">Lưu</button>
            </div>
        </div>
    </div>

    <script>
        // Dữ liệu mẫu cho danh mục
        let categories = [
            { id: '1e4de469-0280-11f0-8579-0242ac110002', name: 'Laptop', parentId: null, level: 1 },
            { id: '663f912f-0283-11f0-8579-0242ac110002', name: 'Phụ kiện', parentId: null, level: 1 },
            { id: '7e5fa3d1-0283-11f0-8579-0242ac110002', name: 'Laptop Gaming', parentId: '1e4de469-0280-11f0-8579-0242ac110002', level: 2 },
            { id: '8a7bc5e3-0283-11f0-8579-0242ac110002', name: 'Laptop Văn Phòng', parentId: '1e4de469-0280-11f0-8579-0242ac110002', level: 2 },
            { id: '95d3e7f5-0283-11f0-8579-0242ac110002', name: 'Bàn Phím', parentId: '663f912f-0283-11f0-8579-0242ac110002', level: 2 },
            { id: 'a1f509a7-0283-11f0-8579-0242ac110002', name: 'Chuột', parentId: '663f912f-0283-11f0-8579-0242ac110002', level: 2 },
            { id: 'ad12cb99-0283-11f0-8579-0242ac110002', name: 'Laptop Gaming Cao Cấp', parentId: '7e5fa3d1-0283-11f0-8579-0242ac110002', level: 3 },
        ];

        // Biến để lưu trạng thái hiện tại
        let currentEditingId = null;
        let isEditing = false;

        // Hàm hiển thị thông báo
        function showMessage(message, type = 'success') {
            const messageContainer = document.getElementById('message-container');
            const messageElement = document.createElement('div');
            messageElement.className = `message message-${type}`;
            
            messageElement.innerHTML = `
                <div class="message-icon">${type === 'success' ? '✓' : '✗'}</div>
                <div class="message-content">${message}</div>
                <button class="message-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            messageContainer.appendChild(messageElement);
            
            // Hiển thị thông báo
            setTimeout(() => {
                messageElement.classList.add('show');
            }, 100);
            
            // Tự động ẩn thông báo sau 3 giây
            setTimeout(() => {
                messageElement.classList.remove('show');
                setTimeout(() => {
                    messageElement.remove();
                }, 300);
            }, 3000);
        }

        // Hàm mở modal thêm danh mục
        function openAddModal() {
            document.getElementById('modal-title').textContent = 'Thêm Danh Mục Mới';
            document.getElementById('category-name').value = '';
            document.getElementById('parent-category').value = 'NULL';
            loadParentCategories();
            
            isEditing = false;
            currentEditingId = null;
            
            document.getElementById('category-modal').classList.add('active');
        }

        // Hàm mở modal sửa danh mục
        function openEditModal(id) {
            const category = categories.find(cat => cat.id === id);
            if (!category) return;
            
            document.getElementById('modal-title').textContent = 'Chỉnh Sửa Danh Mục';
            document.getElementById('category-name').value = category.name;
            
            loadParentCategories(id);
            document.getElementById('parent-category').value = category.parentId || 'NULL';
            
            isEditing = true;
            currentEditingId = id;
            
            document.getElementById('category-modal').classList.add('active');
        }

        // Hàm đóng modal
        function closeModal() {
            document.getElementById('category-modal').classList.remove('active');
        }

        // Hàm tải các danh mục cha vào dropdown
        function loadParentCategories(excludeId = null) {
            const parentSelect = document.getElementById('parent-category');
            
            // Xóa tất cả các option hiện tại trừ option đầu tiên
            while (parentSelect.options.length > 1) {
                parentSelect.remove(1);
            }
            
            // Thêm các danh mục cấp 1 và 2 làm danh mục cha (không thêm cấp 3)
            categories.filter(cat => cat.level < 3 && cat.id !== excludeId).forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                
                // Thêm dấu gạch ngang để biểu thị cấp độ
                let prefix = '';
                if (category.level === 2) {
                    prefix = '— ';
                }
                
                option.textContent = prefix + category.name;
                parentSelect.appendChild(option);
            });
        }

        // Hàm lưu danh mục
        function saveCategory() {
            const categoryName = document.getElementById('category-name').value.trim();
            const parentId = document.getElementById('parent-category').value;
            
            if (!categoryName) {
                showMessage('Vui lòng nhập tên danh mục', 'error');
                return;
            }
            
            // Xác định cấp độ dựa trên danh mục cha
            let level = 1;
            if (parentId !== 'NULL') {
                const parentCategory = categories.find(cat => cat.id === parentId);
                level = parentCategory ? parentCategory.level + 1 : 1;
                
                // Kiểm tra không cho phép tạo danh mục cấp 4
                if (level > 3) {
                    showMessage('Không thể tạo danh mục sâu hơn 3 cấp', 'error');
                    return;
                }
            }
            
            if (isEditing) {
                // Cập nhật danh mục hiện có
                const categoryIndex = categories.findIndex(cat => cat.id === currentEditingId);
                if (categoryIndex !== -1) {
                    // Lưu thông tin danh mục cũ để kiểm tra cấp độ con
                    const oldCategory = {...categories[categoryIndex]};
                    
                    // Cập nhật danh mục
                    categories[categoryIndex].name = categoryName;
                    categories[categoryIndex].parentId = parentId === 'NULL' ? null : parentId;
                    categories[categoryIndex].level = level;
                    
                    // Cập nhật cấp độ cho các danh mục con
                    updateChildrenLevels(currentEditingId, oldCategory.level, level);
                    
                    showMessage('Cập nhật danh mục thành công');
                }
            } else {
                // Thêm danh mục mới
                const newCategory = {
                    id: generateUUID(),
                    name: categoryName,
                    parentId: parentId === 'NULL' ? null : parentId,
                    level: level
                };
                
                categories.push(newCategory);
                showMessage('Thêm danh mục mới thành công');
            }
            
            // Đóng modal và cập nhật giao diện
            closeModal();
            renderCategoriesTable();
        }

        // Hàm cập nhật cấp độ cho các danh mục con
        function updateChildrenLevels(parentId, oldLevel, newLevel) {
            const levelDiff = newLevel - oldLevel;
            
            // Tìm tất cả danh mục con
            const children = categories.filter(cat => cat.parentId === parentId);
            
            children.forEach(child => {
                // Cập nhật cấp độ
                child.level += levelDiff;
                
                // Nếu cấp vượt quá 3, xử lý (có thể hiển thị thông báo hoặc điều chỉnh)
                if (child.level > 3) {
                    child.level = 3;
                }
                
                // Đệ quy cập nhật cho con của con
                updateChildrenLevels(child.id, child.level - levelDiff, child.level);
            });
        }

        // Hàm xóa danh mục
        function deleteCategory(id) {
            // Kiểm tra xem có danh mục con không
            const hasChildren = categories.some(cat => cat.parentId === id);
            
            if (hasChildren) {
                if (!confirm('Danh mục này có chứa danh mục con. Xóa danh mục này sẽ xóa tất cả danh mục con. Bạn có chắc chắn muốn xóa?')) {
                    return;
                }
                
                // Xóa tất cả danh mục con (đệ quy)
                deleteChildren(id);
            } else {
                if (!confirm('Bạn có chắc chắn muốn xóa danh mục này?')) {
                    return;
                }
            }
            
            // Xóa danh mục hiện tại
            categories = categories.filter(cat => cat.id !== id);
            
            showMessage('Xóa danh mục thành công');
            renderCategoriesTable();
        }

        // Hàm xóa đệ quy các danh mục con
        function deleteChildren(parentId) {
            // Tìm tất cả danh mục con
            const children = categories.filter(cat => cat.parentId === parentId);
            
            children.forEach(child => {
                // Xóa các danh mục con của con hiện tại
                deleteChildren(child.id);
                
                // Xóa con hiện tại
                categories = categories.filter(cat => cat.id !== child.id);
            });
        }

        // Hàm hiển thị bảng danh mục
        function renderCategoriesTable() {
            const tableBody = document.getElementById('categories-table');
            tableBody.innerHTML = '';
            
            // Sắp xếp danh mục theo cấp độ và tên
            const sortedCategories = [...categories].sort((a, b) => {
                // Sắp xếp trước tiên theo cấp 1
                if (!a.parentId && !b.parentId) {
                    return a.name.localeCompare(b.name);
                }
                
                // Danh mục cấp 1 lên trước
                if (!a.parentId) return -1;
                if (!b.parentId) return 1;
                
                // Nếu cùng có danh mục cha
                if (a.parentId === b.parentId) {
                    return a.name.localeCompare(b.name);
                }
                
                // Nhóm theo danh mục cha
                const aParentIndex = categories.findIndex(cat => cat.id === a.parentId);
                const bParentIndex = categories.findIndex(cat => cat.id === b.parentId);
                
                if (aParentIndex !== bParentIndex) {
                    return aParentIndex - bParentIndex;
                }
                
                return a.name.localeCompare(b.name);
            });
            
            // Hiển thị danh sách danh mục
            sortedCategories.forEach(category => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="cat-${category.id}" class="checkbox-custom">
                            <label for="cat-${category.id}" class="checkmark"></label>
                        </div>
                    </td>
                    <td class="category-level-${category.level}">${category.name}</td>
                    <td>${category.id}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-edit" onclick="openEditModal('${category.id}')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M11 4H4C3.44772 4 3 4.44772 3 5V19C3 19.5523 3.44772 20 4 20H18C18.5523 20 19 19.5523 19 19V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M18.5 2.5C18.7626 2.23735 19.1106 2.07856 19.4774 2.05147C19.8443 2.02438 20.2094 2.13052 20.5 2.35C20.7906 2.56948 20.9921 2.88917 21.0719 3.24771C21.1516 3.60625 21.1039 3.98343 20.9375 4.3125C20.7711 4.64157 20.5 4.91667 20.5 4.91667L12 13.4167L9.5 13.9167L10 11.4167L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="btn-delete" onclick="deleteCategory('${category.id}')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
                tableBody.appendChild(row);
            });
        }

        // Hàm tạo UUID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/[x]/g, function(c) {
                const r = Math.random() * 16 | 0;
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }

        // Hàm xử lý chọn tất cả checkbox
        document.getElementById('select-all').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.checkbox-custom');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });

        // Khởi tạo trang khi tải xong
        document.addEventListener('DOMContentLoaded', function() {
            renderCategoriesTable();
            
            // Chức năng tìm kiếm có thể được thêm vào đây
            
            // Chức năng phân trang có thể được thêm vào đây
        });

        // Hàm xử lý khi thay đổi parent category để đảm bảo không tạo chu trình
        document.getElementById('parent-category').addEventListener('change', function() {
            const selectedParentId = this.value;
            
            // Nếu đang chỉnh sửa một danh mục, không cho phép chọn con của nó làm cha
            if (isEditing && selectedParentId !== 'NULL') {
                // Kiểm tra xem danh mục được chọn có phải là con của danh mục đang sửa không
                if (isDescendantOf(selectedParentId, currentEditingId)) {
                    alert('Không thể chọn danh mục con làm danh mục cha');
                    this.value = 'NULL';
                }
            }
        });

        // Hàm kiểm tra xem một danh mục có phải là con cháu của một danh mục khác không
        function isDescendantOf(categoryId, ancestorId) {
            let current = categories.find(cat => cat.id === categoryId);
            
            while (current && current.parentId) {
                if (current.parentId === ancestorId) {
                    return true;
                }
                current = categories.find(cat => cat.id === current.parentId);
            }
            
            return false;
        }

        // Hàm lọc và hiển thị danh mục
        function filterCategories(searchTerm = '') {
            const filteredCategories = categories.filter(category => 
                category.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            // Phần xử lý và hiển thị danh mục sau khi lọc
            const tableBody = document.getElementById('categories-table');
            tableBody.innerHTML = '';
            
            if (filteredCategories.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center;">Không tìm thấy danh mục phù hợp</td>
                `;
                tableBody.appendChild(row);
                return;
            }
            
            // Hiển thị danh sách đã lọc
            filteredCategories.forEach(category => {
                // Tương tự phần code trong renderCategoriesTable()
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="cat-${category.id}" class="checkbox-custom">
                            <label for="cat-${category.id}" class="checkmark"></label>
                        </div>
                    </td>
                    <td class="category-level-${category.level}">${category.name}</td>
                    <td>${category.id}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-edit" onclick="openEditModal('${category.id}')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M11 4H4C3.44772 4 3 4.44772 3 5V19C3 19.5523 3.44772 20 4 20H18C18.5523 20 19 19.5523 19 19V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M18.5 2.5C18.7626 2.23735 19.1106 2.07856 19.4774 2.05147C19.8443 2.02438 20.2094 2.13052 20.5 2.35C20.7906 2.56948 20.9921 2.88917 21.0719 3.24771C21.1516 3.60625 21.1039 3.98343 20.9375 4.3125C20.7711 4.64157 20.5 4.91667 20.5 4.91667L12 13.4167L9.5 13.9167L10 11.4167L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="btn-delete" onclick="deleteCategory('${category.id}')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Thêm chức năng tìm kiếm
        function addSearchFunctionality() {
            // Tạo phần tử tìm kiếm và thêm vào header
            const header = document.querySelector('header');
            const searchContainer = document.createElement('div');
            searchContainer.className = 'search-container';
            searchContainer.style.cssText = 'display: flex; align-items: center; margin-bottom: 20px;';
            
            searchContainer.innerHTML = `
                <input type="text" id="search-input" placeholder="Tìm kiếm danh mục..." style="flex: 1; padding: 10px; border-radius: 4px; border: 1px solid var(--border-color);">
                <button id="search-button" class="btn" style="margin-left: 10px; background-color: var(--primary-color); color: white; padding: 10px 15px; border-radius: 4px; border: none;">Tìm kiếm</button>
            `;
            
            // Chèn phần tử tìm kiếm sau header
            header.parentNode.insertBefore(searchContainer, header.nextSibling);
            
            // Xử lý sự kiện tìm kiếm
            document.getElementById('search-button').addEventListener('click', function() {
                const searchTerm = document.getElementById('search-input').value;
                filterCategories(searchTerm);
            });
            
            // Tìm kiếm khi nhấn Enter
            document.getElementById('search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = this.value;
                    filterCategories(searchTerm);
                }
            });
        }

        // Chức năng xóa nhiều danh mục đã chọn
        function addBulkDeleteFunctionality() {
            const header = document.querySelector('header');
            const bulkActionContainer = document.createElement('div');
            bulkActionContainer.className = 'bulk-action-container';
            bulkActionContainer.style.cssText = 'display: flex; align-items: center; margin-bottom: 20px; display: none;';
            
            bulkActionContainer.innerHTML = `
                <span style="margin-right: 10px;">Đã chọn <span id="selected-count">0</span> mục</span>
                <button id="bulk-delete" class="btn" style="background-color: var(--danger-color); color: white; padding: 8px 15px; border-radius: 4px; border: none;">Xóa đã chọn</button>
            `;
            
            // Chèn phần tử hành động hàng loạt sau phần tìm kiếm
            const searchContainer = document.querySelector('.search-container');
            if (searchContainer) {
                searchContainer.parentNode.insertBefore(bulkActionContainer, searchContainer.nextSibling);
            } else {
                header.parentNode.insertBefore(bulkActionContainer, header.nextSibling);
            }
            
            // Xử lý khi chọn các checkbox
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('checkbox-custom')) {
                    updateSelectedCount();
                }
            });
            
            // Xử lý nút xóa hàng loạt
            document.getElementById('bulk-delete').addEventListener('click', function() {
                const checkedBoxes = Array.from(document.querySelectorAll('.checkbox-custom:checked')).filter(cb => cb.id !== 'select-all');
                
                if (checkedBoxes.length === 0) {
                    alert('Vui lòng chọn ít nhất một danh mục để xóa');
                    return;
                }
                
                if (confirm(`Bạn có chắc chắn muốn xóa ${checkedBoxes.length} danh mục đã chọn không?`)) {
                    checkedBoxes.forEach(checkbox => {
                        const categoryId = checkbox.id.replace('cat-', '');
                        deleteCategory(categoryId);
                    });
                    
                    showMessage(`Đã xóa thành công ${checkedBoxes.length} danh mục`);
                    document.getElementById('select-all').checked = false;
                    updateSelectedCount();
                }
            });
        }

        // Hàm cập nhật số lượng mục đã chọn
        function updateSelectedCount() {
            const checkedBoxes = Array.from(document.querySelectorAll('.checkbox-custom:checked')).filter(cb => cb.id !== 'select-all');
            const count = checkedBoxes.length;
            
            document.getElementById('selected-count').textContent = count;
            
            // Hiển thị hoặc ẩn thanh công cụ hành động hàng loạt
            const bulkActionContainer = document.querySelector('.bulk-action-container');
            if (bulkActionContainer) {
                bulkActionContainer.style.display = count > 0 ? 'flex' : 'none';
            }
        }

        // Khởi tạo trang khi tải xong
        document.addEventListener('DOMContentLoaded', function() {
            renderCategoriesTable();
            addSearchFunctionality();
            addBulkDeleteFunctionality();
            
            // Có thể thêm chức năng phân trang ở đây nếu cần
        });
    </script>
</body>
</html>