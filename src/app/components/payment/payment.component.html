<app-header></app-header>
<!-- Thêm p-toast để hiển thị thông báo -->
<p-toast></p-toast>

<div class="main">
  <div class="main-container">
    <div class="content-detail" style="background-color: rgb(248,250,252);">
      <div class="detail-left">
        <p-card>
          <div class="bnt_info">
            <a href="" style="font-size: 16px;">THÔNG TIN KHÁCH HÀNG</a>
          </div>
          <div class="cachthuc">
            <div class="h3_title">
              <h3>Chọn cách thức mua hàng</h3>
            </div>
            <div class="typeReceive">
              <div class="bnt_cachthuc">
                <img src="https://trungtran.vn/modules/products/assets/images/home_cart.png" alt="">
                <span>Giao tận nơi</span>
              </div>
              <div class="bnt_cachthuc">
                <img src="https://trungtran.vn/modules/products/assets/images/cuahang.png" alt="">
                <span>Nhận tại cửa hàng</span>
              </div>
            </div>
          </div>
          <div class="gender_cart">
            <div class="card flex justify-content-center">
              <div class="flex flex-wrap gap-3">
                <div class="flex align-items-center">
                  <p-radioButton name="male" value="Nam" [(ngModel)]="gender" inputId="male"></p-radioButton>
                  <label for="male" class="ml-2">Anh</label>
                </div>
                <div class="flex align-items-center">
                  <p-radioButton name="female" value="Nữ" [(ngModel)]="gender" inputId="female"></p-radioButton>
                  <label for="female" class="ml-2">Chị</label>
                </div>
              </div>
            </div>
          </div>
          <div class="info_form">
            <div class="col-md-6 col-xs-12">
              <div class="card flex justify-content-center">
                <div class="flex flex-column gap-2">
                  <label for="username">Họ và tên *</label>
                  <input pInputText id="username" aria-describedby="username-help" [(ngModel)]="fullName">
                </div>
              </div>
            </div>
            <div class="col-md-6 col-xs-12">
              <div class="card flex justify-content-center">
                <div class="flex flex-column gap-2">
                  <label for="username">Số điện thoại *</label>
                  <input pInputText id="username" aria-describedby="username-help" [(ngModel)]="phoneNumber">
                </div>
              </div>
            </div>
            <!-- Phần chọn Tỉnh/Thành phố -->
            <div class="col-md-6 col-xs-12">
              <div class="card flex justify-content-center">
                <div class="flex flex-column gap-2">
                  <label>Tỉnh/ Thành phố *</label>
                  <select [(ngModel)]="selectedProvince" (change)="loadDistricts()">
                    <option value="">-- Chọn tỉnh/ Thành phố --</option>
                    <option *ngFor="let prov of provinces" [value]="prov.code">
                      {{ prov.name }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <!-- Phần chọn Quận/Huyện -->
            <div class="col-md-6 col-xs-12">
              <div class="card flex justify-content-center">
                <div class="flex flex-column gap-2">
                  <label>Quận/ Huyện *</label>
                  <select [(ngModel)]="selectedDistrict" (change)="loadWards()" [disabled]="!selectedProvince">
                    <option value="">-- Chọn quận/ Huyện --</option>
                    <option *ngFor="let dist of districts" [value]="dist.code">
                      {{ dist.name }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <!-- Phần chọn Phường/Xã -->
            <div class="col-md-6 col-xs-12">
              <div class="card flex justify-content-center">
                <div class="flex flex-column gap-2">
                  <label>Phường/ Xã *</label>
                  <select [(ngModel)]="selectedWard" (change)="onWardChange()" [disabled]="!selectedDistrict">
                    <option value="">-- Chọn phường/ Xã --</option>
                    <option *ngFor="let w of wards" [value]="w.code">
                      {{ w.name }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <!-- Số nhà, tên đường -->
            <div class="col-md-6 col-xs-12">
              <div class="card flex justify-content-center">
                <div class="flex flex-column gap-2">
                  <label for="username">Số nhà, tên đường *</label>
                  <input pInputText id="username" aria-describedby="username-help" [(ngModel)]="street">
                </div>
              </div>
            </div>
          </div>
          <div class="type_address">
            <p>Loại địa chỉ</p>
            <div class="card flex justify-content-center">
              <div class="flex flex-wrap gap-3">
                <div class="flex align-items-center">
                  <p-radioButton name="pizza" value="NHÀ RIÊNG" [(ngModel)]="addressType"
                    inputId="home"></p-radioButton>
                  <label for="home" class="ml-2">NHÀ RIÊNG ( giao hàng tất cả thời gian )</label>
                </div>
                <div class="flex align-items-center">
                  <p-radioButton name="pizza" value="CƠ QUAN" [(ngModel)]="addressType"
                    inputId="office"></p-radioButton>
                  <label for="office" class="ml-2">CƠ QUAN ( giao hàng giờ hành chính )</label>
                </div>
              </div>
            </div>
          </div>
          <div class="note">
            <div class="col-md-6 col-xs-12">
              <div class="card flex justify-content-center">
                <div class="flex flex-column gap-2 w-full">
                  <input pInputText id="username" aria-describedby="username-help"
                    placeholder="Yêu cầu khác (không bắt buộc)" [(ngModel)]="note">
                </div>
              </div>
            </div>
          </div>
        </p-card>

        <p-card>
          <div class="bnt_info">
            <a href="" style="font-size: 16px; padding-top: 10px;">PHƯƠNG THỨC THANH TOÁN</a>
          </div>
          <div class="payment-method">
            <p-radioButton name="payment" value="COD" [(ngModel)]="paymentMethod" inputId="cod"></p-radioButton>
            <label for="cod">COD</label>
            <p-radioButton name="payment" value="VNPay" [(ngModel)]="paymentMethod" inputId="vnpay"></p-radioButton>
            <label for="vnpay">VNPay</label>
          </div>
        </p-card>
      </div>
      
      <!-- Phần HTML cho giỏ hàng với layout mới -->
      <div class="detail-right">
        <p-card>
          <div class="p-grid">
            <div class="p-col-12">
              <h2>SẢN PHẨM ĐÃ CHỌN</h2>
            </div>

            <!-- Hiển thị thông báo khi giỏ hàng trống -->
            <div class="cart-empty" *ngIf="cartItems.length === 0">
              <p>Không có sản phẩm nào trong giỏ hàng</p>
            </div>

            <!-- Lặp qua các sản phẩm trong giỏ hàng với layout mới -->
            <div class="cart-item" *ngFor="let item of cartItems; let i = index">
              <button class="remove-btn" (click)="removeItem(i)">×</button>
              <div class="cart-content">
                <!-- Hình ảnh sản phẩm -->
                <div class="cart-image">
                  <img [src]="item.avatar" [alt]="item.name">
                </div>
                
                <!-- Chi tiết sản phẩm -->
                <div class="cart-details">
                  <h3 class="product-title">{{ item.name }}</h3>
                  <div class="price">
                    <span class="discounted-price">{{ item.price | number:'1.0-0' }}đ</span>
                  </div>
                  <div class="quantity-selector">
                    <button class="qty-btn" (click)="updateQuantity(item, -1)">−</button>
                    <input type="number" [(ngModel)]="item.quantity" min="1" (change)="calculateTotalAmount()">
                    <button class="qty-btn" (click)="updateQuantity(item, 1)">+</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tổng giá trị -->
            <div class="total-price-products">
              <p>Tạm tính ({{ cartItems.length }}) sản phẩm:
                <span class="price_tam">{{ totalAmount | number:'1.0-0' }}đ</span>
              </p>
              <p>Phí vận chuyển:
                <span>{{ shippingFee }}</span>
              </p>
            </div>
            <p class="total_end">Tổng tiền:
              <span class="total_money">{{ (totalAmount - discountAmount) | number:'1.0-0' }}đ</span>
            </p>

            <!-- Nút đặt hàng -->
            <div class="btn-area">
              <a (click)="placeOrder()" id="cod-btn" class="payment-btn cod-btn-payment" title="Đặt hàng">
                Đặt hàng
              </a>
            </div>
          </div>
        </p-card>
      </div>
    </div>
  </div>
</div>